/** * This code is part of the Bumpslide Library by David Knape * http://bumpslide.com/ *  * Copyright (c) 2006, 2007, 2008 by Bumpslide, Inc. *  * Released under the open-source MIT license. * http://www.opensource.org/licenses/mit-license.php * see LICENSE.txt for full license terms */  package com.bumpslide.ui {	import com.bumpslide.ui.constants.Direction;	import flash.events.MouseEvent;	/**	 * Base class for ScrollPanel, TextPanel, and Grid	 *    	 * @author David Knape	 */	public class AbstractScrollPanel extends Panel {		// the scrollbar		public var scrollbar:Slider;				protected var _scrollbarClass:Class = Slider;				// the current scroll position 		protected var _scrollPosition:Number=0;			// amount to scroll for each click		protected var _scrollAmount:Number=8;		// width of scrollbar (height when horizontal)		protected var _scrollbarWidth:Number=20;		// space between scrollbar and content		protected var _gap:Number=4;		// options		protected var _showScrollbarWhenDisabled:Boolean=false;		protected var _orientation:String=Direction.VERTICAL;		protected var _tweenEnabled:Boolean=true;		protected var _scrollbarClassChanged:Boolean = false;		protected var _tweenEasingFactor:Number=.3;				/**		 * Created background and scrollbar is they don't already exist,		 * and assigns this class to be the scrollTarget of the scrollbar (VSlider)		 */		override protected function addChildren():void {								super.addChildren();						_gap = DEFAULT_PADDING;						initScrollbar();			// cache content as bitmap for smoother scrolling			_holder.cacheAsBitmap = true;						// listen for mouse wheel			addEventListener(MouseEvent.MOUSE_WHEEL, onMouseWheel);		}		protected function initScrollbar():void {			if(_scrollbarClassChanged) {								destroyChild( scrollbar );			}						if(scrollbar == null || _scrollbarClassChanged) {				_scrollbarClassChanged = false;				scrollbar = new scrollbarClass() as Slider;				scrollbar.orientation = isVertical ? Direction.VERTICAL : Direction.HORIZONTAL;								addChild(scrollbar);				_scrollbarClassChanged = false;			} else { 				scrollbarWidth = isVertical ? scrollbar.width : scrollbar.height;			}					initScrollTarget();			}				/**		 * Handle mouse wheel scrolling		 */		protected function onMouseWheel(event:MouseEvent):void {			scrollbar.value -= event.delta * scrollAmount;			scrollbar.scrollTarget.scrollPosition = scrollbar.value;		}		/**		 * Initialize the scroll target		 */		protected function initScrollTarget():void {			throw new Error('This should be overriden in a subclass,');		}				/**		 * update size, position, and visibility of child components		 */		override protected function drawContent():void {							// first size content to fill (no scrollbar)			setContentSize(contentWidth, contentHeight);						// if scrollbar doesn't exist, we haven't been fully initialized, get out			if(!scrollbar) return;						// see if scroll bar is necessary			var scroll_needed:Boolean = scrollbar.scrollTarget && (scrollbar.scrollTarget.totalSize > scrollbar.scrollTarget.visibleSize);						// if we need a scrollbar, resize the content to accomodate the scrollbar			if(scroll_needed || showScrollbarWhenDisabled) {								// we need a scrollbar, show it and size it				scrollbar.visible = true;									if(isVertical) {					scrollbar.setSize( scrollbarWidth, height-padding.height);					setContentSize(contentWidth - (scrollbar.width + gap), contentHeight);				} else {					scrollbar.setSize( width-padding.width, scrollbarWidth );					setContentSize(contentWidth, contentHeight - (scrollbar.height + gap));				}			} else {				// no need for a scrollbar, hide it				scrollbar.visible = false;			}						// update scrollbar value (just in case)			constrainScrollPosition();			scrollbar.value = scrollbar.scrollTarget.scrollPosition;						positionContent();			positionScrollbar();		}				/**		 * Override this is you want the scrollbar someplace else		 */		protected function positionScrollbar():void {			if(isVertical) {				scrollbar.move( width-scrollbarWidth-padding.right, padding.top);			} else {				scrollbar.move( padding.left, height-scrollbarWidth-padding.bottom );			}					}				protected function constrainScrollPosition():void {			if(scrollbar.scrollTarget.totalSize <= scrollbar.scrollTarget.visibleSize) _scrollPosition = 0;			else _scrollPosition = Math.max(0, Math.min(scrollbar.scrollTarget.totalSize - scrollbar.scrollTarget.visibleSize, _scrollPosition));		}		/**		 * Reset scroll to 0 and refresh (after content change)		 */		public function reset():void {				_scrollPosition = 0;			scrollbar.value = 0;			scrollbar.updateNow();			invalidate();		}		//-------------------		// GETTERS/SETTERS		//-------------------		/**		 * horizontal or vertical orientation		 */		public function get orientation():String {			return _orientation;		}		public function set orientation(orientation:String):void {			if(_orientation == orientation) return;			_orientation = orientation;			scrollbar.orientation = orientation;				updateNow();			//trace('done');		}		/**		 * if false, scrollbar is hidden when not needed (default:true)		 */		public function get showScrollbarWhenDisabled():Boolean {			return _showScrollbarWhenDisabled;		}		public function set showScrollbarWhenDisabled(showScrollbarWhenDisabled:Boolean):void {			_showScrollbarWhenDisabled = showScrollbarWhenDisabled;			invalidate();		}		/**		 * number of pixels between scrollbar and content		 */		public function get gap():Number {			return _gap;		}		public function set gap(gap:Number):void {			if(_gap==gap) return;			_gap = gap;			invalidate();		}		public function get scrollAmount():Number {			return _scrollAmount;		}		public function set scrollAmount(scrollAmount:Number):void {			_scrollAmount = scrollAmount;		}		public function get scrollbarWidth():Number {			return _scrollbarWidth;		}		public function set scrollbarWidth(scrollbarWidth:Number):void {			_scrollbarWidth = scrollbarWidth;		}		public function get tweenEnabled():Boolean {			return _tweenEnabled;		}		public function set tweenEnabled(tweenEnabled:Boolean):void {			_tweenEnabled = tweenEnabled;		}		public function get isVertical():Boolean {			return orientation == Direction.VERTICAL;		}				public function get scrollbarClass():Class {			return _scrollbarClass;		}				public function set scrollbarClass(scrollbarClass:Class):void {			_scrollbarClass = scrollbarClass;			_scrollbarClassChanged = true;			initScrollbar();			scrollbarWidth = isVertical ? scrollbar.width : scrollbar.height;			invalidate();		}				public function get tweenEasingFactor():Number {			return _tweenEasingFactor;		}				public function set tweenEasingFactor(tweenEasingFactor:Number):void {			_tweenEasingFactor = tweenEasingFactor;		}	}}